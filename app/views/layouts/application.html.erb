<!DOCTYPE html>
<html>
<head>
  <title>Toystory</title>
  <%= stylesheet_link_tag    "application" %>
  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tags %>
</head>
<body>
	<div id="container">
		<div id="page">
			<div id="top">
				<div id="header">
					<div id="header-bg"></div>
					<div id="header-shadow"></div>
					<div id="header-content">
						<div class="header-left">
							<div id="top-nav">
								<ul>
									<li class="active">
										<a id="nav-home" href="../" >首页</a>
									</li>
									<li>
										<a id="nav-profile" href="/users/<%= current_user.id %>">个人主页</a>
									</li>
									<li>
										<a id="nav-create-contest" href="/contests/new">创建竞赛</a>
									</li>
								</ul>
							</div>
						</div>
						
						
						<div class="header-right logged-in">
							<div id="user-info" class="drop-info-menu inactive-menu">
								<div id="user-drop-links" class="hand-cursor user-drop-icon">
									<img id="user-image" src="<%= current_user.picture.url %>">
									<span id="user-name"><%= current_user.username %></span>
								</div>
								<div id="dropdown-links" class="dropdown-menu">
									<div class="nav-arrow-border"></div>
									<div class="nav-arrow"></div>
									<a id="credit-history-btn" href="/history/credit_history" logdata="button_type=4010&amp;event_type=button_clicked" class="dropdown-menu-item bottom-divider-line">
										History
									</a>
									<a href="/setting" logdata="button_type=4013&amp;event_type=button_clicked" class="dropdown-menu-item bottom-divider-line">
										Settings
									</a>
									<%= link_to "Logout", "/users/sign_out", :id => "logout-btn", :class => "dropdown-menu-item non-bottom-line" %>
								</div>
							</div>
							<span class="vertical-divider"></span>
							<div id="notifications" class="notifications-menu inactive-menu">
								<div class="icon-outer">
									<div id="notification-icon" class="notifications-icon hand-cursor " tip-text="Notifications">
										<span id="notification-new-num" style="display:none; "></span>
									</div>
								</div>
								<div id="notification-menu" class="notification-content" style="display: none; ">
									<div class="nav-arrow-border"></div>
									<div class="nav-arrow"></div>
									<div class="notification-title">
										Notifications
									</div>
									<div id="notification-empty" class="notification-item empty non-bottom-line" style="display:none">
										You have no new notifications.
									</div>
									<div id="notification-items">
										<a id="follow" href="" class="notification-item item-inverse" style="display:none">
											<span class="user-name"></span> is now following you.
											<br><span class="notification-timeago"></span>
										</a>
										<a id="entry" href="" class="notification-item item-inverse" style="display:none">
											<span class="user-name"></span> has submitted an entry for your contest <span id="contest_title"></span>.
											<br><span class="notification-timeago"></span>
										</a>
									</div>
									<a class="notification-seeall item-inverse display-block" href="/notifications">
										<span>See All Notifications</span>
									</a>
								</div>
							</div>
							<span class="vertical-divider"></span>
							<div id="nav-messages" class="notifications-menu inactive-menu">
								<div class="icon-outer">
									<div class="nav-msg-icon hand-cursor" tip-text="Messages">
										<span id="nav-msg-new-num" style="display: none; "></span>
									</div>
								</div>
								<div id="nav-msg-menu" class="notification-content" style="display: none; ">
									<div class="nav-arrow-border"></div>
									<div class="nav-arrow"></div>
									<div class="notification-title">
										<span class="notification-title-left">Messages</span>
										<a id="nav-msg-send" class="notification-right-button" href="#">Send a new message</a>
									</div>
									<div id="nav-msg-content">
										<div id="nav-msg-item-proto" class="notification-item item-inverse" style="display: none">
											<p class="user-name"></p>
											<p class="message-preview"></p>
											<span class="timeago"></span>
										</div>
										<div id="nav-msg-empty" class="notification-item empty" style="display:none">
											You have no new messages.
										</div>
									</div>
										<a class="notification-seeall item-inverse display-block" href="/messages">
											<span>See All Messages</span>
										</a>
									</div>
								</div>
								<span class="vertical-divider"></span>
								<div id="nav-contests" class="notifications-menu inactive-menu">
									<div class="icon-outer">
										<div class="nav-contest-icon hand-cursor" tip-text="Active Contests">
											<!--<div class="nav-contest-icon hand-cursor " tip-text='Active Contests'>
											<span id="nav-contest-new-num">0</span>-->
										</div>
									</div>
									<div id="nav-contest-menu" class="notification-content" style="display: none; ">
										<div class="nav-arrow-border"></div>
										<div class="nav-arrow"></div>
										<div class="notification-title">
											<span id="notification-title" class="notification-title-left">Active Contests(0)</span>
										</div>
										<div id="nav-contest-content">
											<div id="nav-cnt-empty" class="notification-item empty" style="display:none">
												You have no active contests.
											</div>
											<a  id="nav-ntf-item-proto" href="" class="notification-item item-inverse" style="display:none"></a>
										</div>
										<a class="notification-seeall item-inverse display-block" href="/contests/active_contests">
											<span>See All Active Contests</span>
										</a>
									</div>
								</div>
								<span class="vertical-divider"></span>
								<div id="user-bonus-balance" class="balance-menu float-right">
									<div class="icon-outer">
										<div class="user-bonus-icon hand-cursor" tip-text="Coupons">
											<span class="balance">
												<a id="user-bonus-credit" class="orange" logdata="button_type=4004&amp;event_type=button_clicked" href="/history/credit_history">$110</a>
											</span>
										</div>
									</div>
									<div id="nav-bonus-menu" class="nav-bonus-content">
										<div class="nav-arrow-border"></div>
										<div class="nav-arrow"></div>
										<div class="nav-bonus-container">
											<span class="">You have $110 coupon credits.
												Get <b>$110</b> worth of coupons by 
												<a id="nav-bonus-verify">
													verifying your account now!
												</a>
											</span>
										</div>
									</div>
								</div>
								<span class="vertical-divider"></span>
								<div id="user-credit-balance" class="float-right nav-balance" tip-text="Credits">
									<span class="balance">
										<a id="user-normal-credit" href="http://prizes.org/history/credit_history" logdata="button_type=4004&amp;event_type=button_clicked">$0</a>
									</span>
								</div>
							</div>
						
						
						
					</div>
				</div>
			</div>
			<div id="top_sub"></div>
			<div id="page-layout">
				<div id="page-container" class="clearfix">
          			<%= yield %>
        		</div>
			</div>
		</div>
	
		<div class="page-footer">
		<div class="horizontal-divider page-footer-line">
			<div class="page-footer-icon"></div>
		</div>
		<div class="page-footer-links"> 
			<a href="http://blog.prizes.org/">Blog</a> &nbsp;
			<a href="/tos">Terms Of Service</a> &nbsp;
			<a href="/privacy">Privacy Policy</a> &nbsp;
			<a href="/faq">FAQ</a> &nbsp;
			<a href="/faq#contact">Contact Us</a>
		</div>
	</div>
	</div>
	<div style="position: fixed; top: 0px; z-index: 1010;">
		<div id="dlg-send-message" style="display:none;">
			<div id='message-recipient' class="ui-dialog-box">
				<span>To:</span>
			</div>
			<div id='message-body' class="ui-dialog-box">
				<span>Message:</span>
				<textarea></textarea>
			</div>
			<div id='send-message-countdown'></div>
		</div>
    <div id='dlg-ofac' style="display:none;" class="dlg-plain-content">
  		<div class='ofac-notice'>
  			For payment transactions, we're required by law to collect this information from you once.
  		</div>
  		<div class='ofac-row'>
  			<div class='ofac-field' >
  				<span>Order Number:</span>
  				<span id="order-number"></span>
  			</div>
  		</div>
  		<div class='ofac-row'>
  			<div class='ofac-field' id="alipay-form">
  			</div>
  		</div>
  	</div>
	</div>



	<div id="create-confirm" style="display:none;">
		<div class='contest-detail-container'> 
			<div class="contest-detail clearfix">
				<div class="contest-detail-header clearfix">
					<div class="detail-prize-zone morethan24 radius-border-bottom">
						<div class='detail-prize-title'> PRIZE</div>
						<div class='detail-prize-num'> $<span id='create-prize-credit'></span></div>
					</div>
					<div class="detail-prize-jff-zone morethan24 radius-border-bottom"></div>
					<div class='detail-info-zone'>
						<div class="detail-title">
							<span id="create-confirm-title"></span>
						</div>

						<div class='contest-extend-info'>
							<span class='preview-follow'>Follow Contest</span>
							<div class='left-time-area'>
								<span class='left-time-title'>Time Left :</span>
								<span class='left-time-details'>
									<span id='left-time-num'></span>
								</span>
							</div>

							<div class='share-button-area'>
								<div class="mock-fb-share"></div>
								<div class="mock-twitter-share"></div>
							</div>
						</div>
					</div>
				</div>

				<div class="detail-body detail-bottom-border contest-detail-padding">
					<div id='create-confirm-content' class='contest-detail-content contest-detail-padding detail-top-border word-wrap'> </div>
				</div>

				<div class='contest-bottom-shadow'></div>
			</div>
		</div>
		<div id="createconfirm"> </div>
		<div id="createconfirm-bottom-line">
			Don't worry! Once you've successfully created a contest, we'll keep the prize safe until you've picked a winner!
		</div>
	</div>
	<script type="text/javascript" charset="utf-8">
		var IS_SUSPENDED = 0;
		var CONNECT_TYPE = {"FOLLOWING_USER": 1101, "FOLLOWER_USER": 1102, "FOLLOWING_CONTEST": 1103};
		
		//Messages Pusher
		var pusher = new Pusher('2f20b4687fdaada149b2');
		var message_channel = pusher.subscribe("presence-messages_<%= current_user.id %>");
		
		message_channel.bind('message_created', function(message) {
			var elem = ce6.nav.constructMessageItem(message);
			elem.appendTo('#nav-msg-content');
			
			count = 1;
			if($('#nav-msg-new-num').text().trim() != '')
				count = parseInt($('#nav-msg-new-num').text().trim()) + 1;
			$('#nav-msg-new-num').text(count).show();
			$('.nav-msg-icon').addClass('nav-msg-icon-active');
			$('#nav-msg-menu .notification-item:last').addClass('non-bottom-line');
			$('#nav-msg-empty').hide();
		});
		
		//Notifications Pusher
		var notification_channel = pusher.subscribe("presence-notifications_<%= current_user.id %>");
		notification_channel.bind('notification_created', function(notification) {
			var elem = ce6.nav.contructNotificationItem(notification);
			elem.appendTo('#notification-items');
			
			count = 1;
			if($('#notification-new-num').text().trim() != '')
				count = parseInt($('#notification-new-num').text().trim()) + 1;
			$('#notification-new-num').text(count).show();
			$('#notification-icon').addClass('notifications-icon-active');
			$('#notification-menu .notification-item:last').addClass('non-bottom-line');
			$('#notification-empty').hide();
		});
		
		var viewer = {
			name: "<%= current_user.username %>",
			token: "<%= current_user.id %>",
			picture: "<%= current_user.picture %>"
		};
		
		$(function(){
      <% key = Rails.application.config.session_options[:key] %>
    	var uploadify_script_data = {};
    	var csrf_param = $('meta[name=csrf-param]').attr('content');
    	var csrf_token = $('meta[name=csrf-token]').attr('content');
    	uploadify_script_data[csrf_param] = encodeURI(encodeURIComponent(csrf_token));
    	uploadify_script_data['<%= key %>'] = '<%= cookies[key] %>';

    	$('#uploadify').uploadify({
    		uploader  		: '/assets/uploadify.swf',
    		script    		: '/profile/photo_upload_response',
    		cancelImg		: '/assets/cancel.png',
    		auto			: true,
    		multi			: true,
    		removeCompleted : true,
    		fileExt			: '*.jpg;*.jpeg;*.gif;*.png',
    		fileDesc		: 'Image Files (.JPG, .JPEG, .GIF, .PNG)',
    		scriptData		: uploadify_script_data,
    		wmode			: "transparent",
    		hideButton		: true,
    		height			: 23,
    		width			: 54,
    		queueID			: 'photoUploadQueue',
    		onComplete		: function(event, ID, fileObj, response, data) {
    			response = eval('(' + response + ')');
    			$("#user-mugshot").attr("src", response.picture);
    		}
    	});
    })
	</script>
</body>
</html>
